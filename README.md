This repository contains a set of scripts to perform airdrop functions for the Voi blockchain network.

There are four core scripts located in the `scripts` folder:

# Initial airdrop script - airdrop.js
Performs an airdrop of network tokens to the accounts in `<acctlist>`,
which is a CSV file containing three columns -- account address, account type, and atomic amount

Optional Parameters:
`<blacklist>` -- a CSV containing a list of accounts to exclude from the airdrop
`<group_size>` -- the number of accounts to include in each atomic transaction group
(note -- if an issue arrises with an address, such as it being invalid, all transactions
in the group will fail and be included in the errorList.csv generated by the script)
`<mnemonic>` -- this can be either a mnemonic string (space-separated words) entered inside quotes
on the command line, or the name of a text file containing the mnemonic string

Usage: `node airdrop.js -a <acctlist> [-b <blacklist>] [-g <group_size>] [-m "mnemonic"]`

# Epoch reward calculaton script - epoch_calc.js

Given a `START` and `END`, and an integer of atomic tokens
(`EPOCHREWARD`) to distribute evenly among block proposers, this script calculates the number of tokens
to distribute to each block proposer and writes it to `FILENAME`. This output file can then be used
as the `<acctList>` input to `airdrop.js` to airdrop the alloted tokens to each address.

Note: Due to the intensity and time required to read blocks from the indexer API,
this script will create a SQLite database file named `proposers.db`.
The database is used to store block information and acts as a local cache.

`START` and `END` may be block numbers or dates. If a date is provided, the script will automatically
locate the first block available on the `START` date and the last block available on the `END` date

Usage: `node epoch_calc.js -s START -e END -r EPOCHREWARD [-f FILENAME] [-b BLACKLIST]`  
Example: `node epoch_calc.js -s 240000 -e 250000 -r 2500000 -f rewards.csv -b blacklist.csv`

# Epoch reward calculation from API - epoch_calc_api.js

Similar to `epoch_calc.js` but instead of using a local SQLite database, it will
use an API to retrieve block proposers.

Usage: `node epoch_calc_api.js -s START -e END -r EPOCHREWARD [-f FILENAME] [-b BLACKLIST]`  
Example: `node epoch_calc_api.js -s 240000 -e 250000 -r 2500000 -f rewards.csv -b blacklist.csv`

# Account bucketing scirpt - buckets.js

Usage: `node buckets.js`

NOTE: buckets.js is incomplete. 

# Block finder by timestamp - find_block.js

Given a timestamp in the format YYYY-MM-DDTHH:II:SS, find the block produced at the specified time,
or the next block produced after the specified time. For example, if block 123 is produced at 2023-08-30T07:59:59
and block 124 is produced at 2023-08-30T08:00:01, and the `TIMESTAMP` input is 2023-08-30T08:00:00 then the script
will return 124.

Note that a Z must be included in the time to use UTC time, otherwise the search will be performed based on the
local machine timezone.

This script will also accept a date in the format `YYYY-MM-DD` and will perform a search for the first and last
block produced between 12:00:00AM and 11:59:59PM GMT, and will output the command to run epoch_calc.js

Usage: `node find_block.js -t TIMESTAMP`  
Example: `node find_block.js -t 2023-09-19`

# Block scraper - block_follower.js

This utility script builds out a local SQLite database named `proposers.db` by pulling block data from API endpoints.
It stores the block number, proposer, and block timestamp in the database to be used by `epoch_calc.js` and the
proposers API.

Usage: `node block_follower.js`

# Node Configuration

Algod and Indexer clients will default to nodely's voi-testnet nodes, but can be configured with the environment variables:
- ALGOD_HOST
- ALGOD_PORT
- ALGOD_TOKEN
- INDEXER_HOST
- INDEXER_PORT
- INDEXER_TOKEN
